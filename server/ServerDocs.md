## BackEnd Documentation

# Table of Contents

-[Endpoints](#endpoints)
  - [Companies](#companies)
  - [Seekers](#seekers)
  - [Markers](#markers)


# Authentication is found inside the client in the file App.js

## To Sign Up Users

- Can use different authentication to sign up (Google, Twitter, etc.)
- Must have a unique email to sign up
- Password must be at least 8 characters long

## To Sign In Users

- Email and password are needed that are already active in the authentication database
- Two web tokens are created
  - One is local token that is short lived, only active for an hour
  - Second is on the firebase, the firebase token is long lived,
    only changed if their is a new password or it is deleted

## To Sign Out Users

- Ends the local token, firebase token still persists.

# Endpoints

## Seekers

- Basic format of seeker:

```js
seekers: {
  uid: {
    bio: 'lorem15',
    email: 'example@email.com',
    firstName: 'Test',
    github: 'github.com',
    jobTitle: 'FSW',
    lastName: 'Testington',
    linkedIn: 'linkedIn.com',
    location: {
                city: 'Big Bear Lake',
                coordinates: {
                  0: -116,
                  1: 34
                },
                state: 'CA',
                street: '42200 Moonridge Rd',
                zip: '92315'
              },
    phoneNumber: '555-555-5555',
    portfolio: 'portfolio.com',
    profilePicture: 'profileUrl',
    relocation: false,
    remote: false,
    resume: '',
    twitter: 'twitter.com',
  }
}
```


### Root Endpoint
- https://intense-stream-29923.herokuapp.com/api/database/seekers

### GET 

#### GET all Job Seekers
- https://intense-stream-29923.herokuapp.com/api/database/seekers/all
  - Returns all job seekers

#### GET Seeker Token
- https://intense-stream-29923.herokuapp.com/api/database/seekers/token
  - Sends a custom token with the claim of seeker
  - Useful for testing with Postman

#### GET Specific Job Seekers
- https://intense-stream-29923.herokuapp.com/api/database/seekers/:uid
  - Gets specific user by passing uid through params

- https://intense-stream-29923.herokuapp.com/api/database/seekers
  - Gets specific user when uid is passed through the body
  - Meant to be used with setSeekerClaims middleware

### POST

#### POST Add Users
- https://intense-stream-29923.herokuapp.com/api/database/seekers/addUser
  - Takes in the values of the following object keys: email, firstName, lastName, phoneNumber, jobTitle,location
  - Responds with the following object: {success: `${email} has been added to database.`, customToken: customTokenString}
    - customToken is a token generated by the setSeekerClaims middleware that is used in the frontEnd to sign in first time users


### PUT 

#### PUT User Info
- https://intense-stream-29923.herokuapp.com/api/database/seekers/userInfo
  - Takes in an object with any keys and sees if keys exists in the user's database before updating value.
    - Ex: If { jobTitle: FullStack, favoriteColor: blue } is sent through the request, the user's jobTitle will change to FullStack, but favoriteColor will be ignored.
  - Responses with a message telling the user how many keys/pairs were updated in the database.

### DELETE

#### DELETE Seeker User
- https://intense-stream-29923.herokuapp.com/api/database/seekers
 - Deletes a user from the database
 - Does not delete from auth server


## Companies 
 
- Basic format of companies:

```js
companies: {
  uid: {
    companyName: 'company name.',
    companyWebsite: 'companywebsite.com',
    email: 'company_email@email.com',
    location: {
      city: 'Grand Rapids',
      coordinates: {
        0: -85.67,
        1: 42.96
      },
      state: 'MI',
      street: '1820 Bee Street',
      zip: '49503'
    }
    phoneNumber: '555-555-5555';
    profilePicture: 'profileUrl',
    remote: false
  }
}
```

### GET 

#### GET all Companies
- https://intense-stream-29923.herokuapp.com/api/database/companies/all
  - Returns all companies

#### GET Company Token
- https://intense-stream-29923.herokuapp.com/api/database/companies/token
  - Sends a custom token with the claim of company
  - Useful for testing with Postman

#### GET Specific Companies
- https://intense-stream-29923.herokuapp.com/api/database/companies/:uid
  - Gets specific user by passing uid through params

- https://intense-stream-29923.herokuapp.com/api/database/companies
  - Gets specific user when uid is passed through the body
  - Meant to be used with setCompanyClaims middleware

### POST 

#### POST NEW COMPANY
- https://intense-stream-29923.herokuapp.com/api/database/companies/addUser
  - Takes in an object with the following keys: email, companyName, companyWebsite, phoneNumber, location
    - Responds with the following object: {success: `${email} has been added to database.`, customToken: customTokenString}
    - customToken is a token generated by the setCompanyClaims middleware that is used in the frontEnd to sign in first time users

#### POST New Job Posting
- https://intense-stream-29923.herokuapp.com/api/database/companies/jobsListed
  - Takes in an object with the following keys companyName, date, jobLink, jobTitle, location
  - Responds with { message: 'Job added' }
  
## Markers

- Basic format of Markers:
```
uid: {
  geometry: {
    coordinates: {
      0: -86.747359,
      1: 33.453917
    },
  },
  properties: {
    jobTitle: 'Detective',
    profilePicture: 'profileUrl',
    role: 'seeker',
    title: {
      firstName: 'Detective',
      lastName: 'Pikachu'
    },
    uid: '8Ad6ABu77wNyVE89UrTWtDWsiFl2'
  }
}
```

### GET
  - https://intense-stream-29923.herokuapp.com/api/markers
    -Gets all the markers in the database
    - Responds with the array of marker data

### POST and PUT
  - POST and PUT both are done by the MarkerMiddleware
  - The MarkerMiddleware is used inside the company and seekers POST and PUT, so it update with the user

Marker Middleware for Company:

```
const createMarkerObjectCompany = async (req, res, next) => {
  const { uid } = req.body;
  let { companyName, profilePicture, location } = req.body;

  if (!companyName) {
    companyName = await rootRef
      .child(`companies/${uid}/companyName`)
      .once('value')
      .then(snapshot => snapshot.val());
  }

  if (!profilePicture) {
    profilePicture = await rootRef
      .child(`companies/${uid}/profilePicture`)
      .once('value')
      .then(snapshot => snapshot.val());
  }

  if (!location) {
    location = await rootRef
      .child(`companies/${uid}/location`)
      .once('value')
      .then(snapshot => snapshot.val());
  }

  const markerData = {
    geometry: {
      // Convert Coordinates to Numbers
      coordinates: location.coordinates.map(coord => Number(coord)),
    },
    properties: {
      title: { companyName },
      uid,
      profilePicture,
      role: 'company',
    },
  };
  req.body.markerData = markerData;
  next();
};
```
